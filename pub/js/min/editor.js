!function(x,C){var k,t,w,n,S=x.locoScope,i=x.locoConf,r=S.po.ref.init(S,i),l=null,a=null,o=i.multipart,_=S.l10n,b=S.string.sprintf,D=i.locale,m=S.po.init(D).wrap(i.powrap),s=!D,e=document.getElementById("loco-actions"),c=i.popath,u=i.potpath,d=document.getElementById("loco-fs"),p=d&&S.fs.init(d),f=!i.readonly,g=document.getElementById("loco-editor-inner"),v=i.apis||[],I={};function h(u){S.ajax.post("sync",l,function(t){var n=[],o=m,e=t.po,a=t.pot,i=S.po.init().load(e),r=o.merge(i),l=r.add.length,s=r.del.length,c=_;k.load(o),l||s?(a?n.push(b(c._("Merged from %s"),a)):n.push(c._("Merged from source code")),l&&n.push(b(c._n("1 new string added","%s new strings added",l),l)),s&&n.push(b(c._n("1 obsolete string removed","%s obsolete strings removed",s),s)),C(g).trigger("poUnsaved",[]),q(),x.console&&function(t,n){var o=-1,e=n.add.length;for(;++o<e;)t.log(" + "+n.add[o].source());o=-1,e=n.del.length;for(;++o<e;)t.log(" - "+n.del[o].source())}(console,r)):a?n.push(b(c._("Already up to date with %s"),a)):n.push(c._("Already up to date with source code")),S.notices.success(n.join(". ")),C(g).trigger("poMerge",[t]),u&&u()},u)}function T(){return t=t||function(){for(var t,n=-1,o=[],e=v,a=e.length;++n<a;)try{t=e[n],o.push(S.apis.create(t))}catch(t){S.notices.error(String(t))}return o}()}function y(){v.length?function(){var s=_,t=k.current(),n=k.getTargetOffset(),o=t&&t.source(null,n),c='lang="'+String(D)+'" dir="'+(D.isRTL()?"RTL":"LTR")+'"';if(o){function a(t,n,o,e){var a=e.getId(),i=e.getUrl(),r=String(e),l=b&&b[a];l&&l.replaceWith(C('<div class="loco-api loco-api-'+a+'"></div>').append(C('<a class="loco-api-credit" target="_blank"></a>').attr("href",i).text(r)).append(C("<blockquote "+c+"></blockquote>").text(n||"[FAILED]")).append(C('<button class="button button-primary"></button>').text(s._("Use this translation")).on("click",function(e,a){return function(t){t.preventDefault(),t.stopPropagation(),u();var n=k.current(),o=k.getTargetOffset();n&&n.source(null,o)===e?(n.translate(a,o),k.focus().reloadMessage(n)):S.notices.warn("Source changed since suggestion")}}(t,n)))),d.dialog("option","position",{my:"center",at:"center",of:x}),++m===f&&d&&d.dialog("option","title",s._("Suggested translations")+" â€” "+o.label)}function u(t){d&&null==t&&d.dialog("close"),b=d=null}function e(e){return function(t,n,o){a(t,v[e.getId()]=n,o,e)}}var d=(w=w||C('<div id="loco-hint"></div>').dialog({dialogClass:"loco-modal",modal:!0,autoOpen:!1,closeOnEscape:!0,resizable:!1,minHeight:400})).html("").append(C('<div class="loco-api"><p>Source text:</p></div>').append(C('<blockquote lang="en"></blockquote>').text(o))).dialog("option","title",s._("Loading suggestions")+"...").off("dialogclose").on("dialogclose",u).dialog("open"),i=t.translation(n);i&&C('<div class="loco-api"><p>Current translation:</p></div>').append(C("<blockquote "+c+"></blockquote>").text(i)).append(C('<button class="button"></button>').text(s._("Keep this translation")).on("click",function(t){t.preventDefault(),u()})).appendTo(d);for(var r,l,p=T(),f=p.length,g=-1,v=I[o]||(I[o]={}),b={},m=0;++g<f;)r=p[g],d.append((h=r,void 0,y=C('<div class="loco-api loco-api-loading"></div>').text("Calling "+h+" ..."),b[h.getId()]=y)),l=r.getId(),v[l]?a(o,v[l],D,r):r.translate(o,D,e(r))}var h,y}():M().dialog("open")}function M(){return n||(n=C("#loco-auto")).dialog({dialogClass:"loco-modal",appendTo:"#loco.wrap",title:n.attr("title"),modal:!0,closeOnEscape:!0,resizable:!1,position:{my:"top",at:"top",of:"#loco-content"}}),n}function z(){var e,a,n=0,i=_,o=!1,r=M().dialog("open"),t=r.find("form"),l=t.find("button.button-primary"),s=C("#loco-job-progress");function c(){l[0].disabled=!0}function u(){l.removeClass("loco-loading")}function d(t){s.text(t)}function p(t){var n=function(t){for(var n,o=T(),e=o.length,a=-1;++a<e;)if((n=o[a]).getId()===t)return n;S.notices.error("No "+t+" client")}(C(t.api).val()),o=t.existing.checked;d("Calculating...."),(e=n.createJob()).init(m,o),a=n.toString(),d(b(i._("%s unique source strings."),e.length.format(0))+" "+b(i._("%s characters will be sent for translation."),e.chars.format(0))),e.length?l[0].disabled=!1:c()}function f(t){e&&(o&&t.fuzzy(0,!0),k.pasteMessage(t),t===k.active&&k.setStatus(t),k.unsave(t,0),n++)}function g(t,n){var o=n?100*t/n:0;d(b(i._("Translation progress %s%%"),o.format(0)))}function v(){if(u(),e){var t=e.length-n;0<t&&n&&S.notices.warn(b(i._("Translation job aborted with %s strings remaining"),t.format(0))),0<n&&(S.notices.success(b(i._("%s strings translated via "+a),n.format(0))).stick(),q(),k.rebuildSearch()),e=null,k.fire("poAbort")}r&&(r.off("dialogclose").dialog("close"),r=null)}u(),c(),t.off("submit change"),p(t[0]),t.on("change",function(t){var n=t.target,o=n.name;return"api"!==o&&"existing"!==o||p(n.form),!0}).on("submit",function(t){t.preventDefault(),l.addClass("loco-loading"),c(),g(0),o=t.target.fuzzy.checked,e.dispatch().done(v).each(f).prog(g)}),r.off("dialogclose").on("dialogclose",function(){e.abort(),r=null,v()})}function j(n){var t=C.extend({locale:String(m.locale()||"")},a||{});p&&p.applyCreds(t),o?(t=function(t){var n,o=new FormData;for(n in t)t.hasOwnProperty(n)&&o.append(n,t[n]);return o}(t)).append("po",new Blob([String(m)],{type:"application/x-gettext"}),String(t.path).split("/").pop()||"untitled.po"):t.data=String(m),S.ajax.post("save",t,function(t){n&&n(),k.save(!0),C("#loco-po-modified").text(t.datetime||"[datetime error]")},n)}function E(){return _._("Your changes will be lost if you continue without saving")}function U(e,a){return e.disabled=!1,C(e).click(function(t){var n=e.form,o=c;return"binary"===a&&(o=o.replace(/\.po$/,".mo")),n.path.value=o,n.source.value=m.toString(),!0}),!0}function L(t){return t.preventDefault(),!1}function q(){var t=_,n=k.stats(),o=n.t,e=n.f,a=n.u,i=b(t._n("1 string","%s strings",o),o.format(0)),r=[];D&&(i=b(t._("%s%% translated"),n.p.replace("%",""))+", "+i,e&&r.push(b(t._("%s fuzzy"),e.format(0))),a&&r.push(b(t._("%s untranslated"),a.format(0))),r.length&&(i+=" ("+r.join(", ")+")")),C("#loco-po-status").text(i)}!o||x.FormData&&x.Blob||(o=!1,S.notices.warn("Your browser doesn't support Ajax file uploads. Falling back to standard postdata"));var A,B,O=(B=parseInt(C(g).css("min-height")||0),function(){var t=function(t,n){for(var o=t.offsetTop||0;(t=t.offsetParent)&&t!==n;)o+=t.offsetTop||0;return o}(g,document.body),n=x.innerHeight,o=Math.max(B,n-t-20);A!==o&&(g.style.height=String(o)+"px",A=o)});O(),C(x).resize(O),g.innerHTML="",k=S.po.ed.init(g).localise(_),S.po.kbd.init(k).add("save",function(){k.dirty&&j()}).add("hint",D&&f&&y||L).enable("copy","clear","enter","next","prev","fuzzy","save","invis","hint");var N={save:f&&function(n){function o(){n.disabled=!0}function t(){n.disabled=!1}function e(){t(),C(n).removeClass("loco-loading")}return n,k.on("poUnsaved",function(){t(),C(n).addClass("button-primary loco-flagged")}).on("poSave",function(){o(),C(n).removeClass("button-primary loco-flagged")}),a=C.extend({path:c},i.project||{}),C(n).click(function(t){return t.preventDefault(),o(),C(n).addClass("loco-loading"),j(e),!1}),!0},sync:f&&function(n){var t=i.project;if(t){function o(){n.disabled=!0}function e(){n.disabled=!1}function a(){e(),C(n).removeClass("loco-loading")}k.on("poUnsaved",function(){o()}).on("poSave",function(){e()}),l={bundle:t.bundle,domain:t.domain,type:s?"pot":"po",sync:u||""},C(n).click(function(t){return t.preventDefault(),o(),C(n).addClass("loco-loading"),h(a),!1}),e()}return!0},revert:function(t){return k.on("poUnsaved",function(){t.disabled=!1}).on("poSave",function(){t.disabled=!0}),C(t).click(function(t){return t.preventDefault(),location.reload(),!1}),!0},invs:function(t){var o=C(t);return t.disabled=!1,k.on("poInvs",function(t,n){o[n?"addClass":"removeClass"]("inverted")}),o.click(function(t){return t.preventDefault(),k.setInvs(!k.getInvs()),!1}),locoScope.tooltip.init(o),!0},code:function(t){var o=C(t);return t.disabled=!1,o.click(function(t){t.preventDefault();var n=!k.getMono();return o[n?"addClass":"removeClass"]("inverted"),k.setMono(n),!1}),locoScope.tooltip.init(o),!0},source:U,binary:s?null:U};s?(N.add=f&&function(t){return t.disabled=!1,C(t).click(function(t){t.preventDefault();var n,o=1,e=/(\d+)$/;for(n="New message";m.get(n);)o=e.exec(n)?Math.max(o,RegExp.$1):o,n="New message "+ ++o;return k.add(n),!1}),!0},N.del=f&&function(t){return t.disabled=!1,C(t).click(function(t){return t.preventDefault(),k.del(),!1}),!0}):N.auto=function(t){function n(){t.disabled=!1}return k.on("poUnsaved",function(){t.disabled=!0}).on("poSave poAbort",function(){n()}),C(t).click(function(t){return t.preventDefault(),z(),!1}),n(),!0},C("#loco-toolbar").find("button").each(function(t,n){var o=n.getAttribute("data-loco"),e=N[o];e&&e(n,o)||C(n).hide()}),C(e).submit(L),function(n){function e(t){C(n.parentNode)[t||null==t?"removeClass":"addClass"]("invalid")}k.searchable(S.fulltext.init()),n.disabled=!1,n.value="";var a=S.watchtext(n,function(t){e(k.filter(t,!0))});k.on("poFilter",function(t,n,o){a.val(n||""),e(o)}).on("poMerge",function(t,n){var o=a.val();o&&k.filter(o)})}(document.getElementById("loco-search")),k.on("poUnsaved",function(){x.onbeforeunload=E}).on("poSave",function(){q(),x.onbeforeunload=null}).on("poHint",y).on("poUpdate",q).on("poMeta",function(t,n){var o,e,a=(e="CODE",(o=n).tagName===e?o:o.getElementsByTagName(e)[0]);a&&r.load(a.textContent)}),m.load(i.podata),k.load(m),(D=k.targetLocale)?D.isRTL()&&C(g).addClass("trg-rtl"):k.unlock(),q(),delete x.locoConf,i=N=null}(window,jQuery);